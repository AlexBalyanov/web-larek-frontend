# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/Models/ — папка с моделями данных
- src/components/View/ — папка с моделями представления
- src/components/CommunicationApi/ — папка с Api веб приложения

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные, используемые в приложении, и их типы
\
**Товар**
````
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}
````
\
**Покупатель**
````
interface IUser {
	payment: PaymentMethod;
	email: string;
	phone: string
	address: string;
}
````
\
**Интерфейс модели данных продукта**
````
interface IProductsData {
	products: IProduct[];
	selectedProduct: IProduct;
	events: IEvents;
	setProducts(products: IProduct[]): void;
	getProducts(): IProduct[];
	setPreviewProduct(product: IProduct): void;
	getPreviewProduct(): IProduct;
}
````
\
**Интерфейс модели данных покупателя**
````
interface IUserData {
	payment: PaymentMethod;
	email: string;
	phone: string;
	address: string;
	events: IEvents;
	setUserData(user: Partial<IUser>): void;
	getUserData(): IUser;
	checkUserValidation(): boolean;
}
````
\
**Интерфейс модели данных корзины покупок**
````
interface IBasketData {
	products: IProduct[];
	events: IEvents;
	getProductsList(): IProduct[];
	getProductsCount(): number;
	getProductsPrice(): number;
	addToBasket(product: IProduct): void;
	deleteFromBasket(product: IProduct): void;
	isProductInBasket(id: string): boolean;
}
````
\
**Данные способа оплаты, используемые в модели покупателя**
````
type PaymentMethod = 'cash' | 'online' | '';
````

## Архитектура веб приложения
Код приложения реализован в парадигме MVP:
- слой данных - отвечает за работу с данными веб приложения (хранение, изменение);
- слой отображения - отвечает за работу с отображением данных на странице веб приложения;
- слой взаимодействия (презентер) - отвечает за взаимосвязь между слоями данных и отображения.

### Базовый код

#### Класс Api
Класс содержит в себе логику работы с сервером веб приложения. В конструктор\
передается адрес сервера и конфиг с заголовками запроса.

**Методы класса:**
- `get` - отправляет GET запрос на переданный эндпоинт и возвращает промис объектом\
который послал сервер в качестве ответа;
- `post` - отправляет POST запрос с переданными параметрами: тело запроса JSON и\
эндпоинт сервера\.
По умолчанию стоит POST метод запроса, который можно изменить, передав\
третий параметр при вызове.

#### Класс EventEmitter
Класс реализует брокер событий, с помощью которого можно генерировать различные события\
в слоях приложения, подписываться на них и выполнять нужные действия.

**Основные методы описаны в интерфейсе IEvents:**
- `on` - подписка на событие по его имени;
- `emit` - генерация события с нужным именем;
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое\
в параметрах событие.

#### Класс Component
Базовый класс для работы с разметкой веб приложения. Является родителем всех компонентов\
представления. В конструктор принимает элемент разметки, который является основным\
родительским контейнером.

**Основной метод класса:** 
- `render` - опционально принимает переданные в параметрах данные, при помощи\
Object.assign перезаписывает поля класса-наследника, которые передаются в параметрах дженерика\
и возвращает HTML разметку - контейнер класса.

### Слой данных
Классы отвечают за хранение и работу с данными веб приложения. Интерфейсы для таких\
классов описаны в файле `types/index.ts`.

#### Класс ProductsData
Класс предназначен для хранения и работы с данными карточек товаров, полученных с сервера.\
Конструктор класса принимает `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `products: IProduct[]` - массив карточек товаров, полученных с сервера;
- `selectedProduct: IProduct` - сохраненная карточка, которая будет выбрана\ на главной странице;
- `events: IEvents` - экземпляр класса EventEmitter для генерации событий при изменении данных.

**Методы класса:**
- `setProducts(products: IProduct[]): void` - сохраняет массив товаров в соответствующее поле;
- `getProducts(): IProduct[]` - возвращает массив товаров;
- `setProductPreview(product: IProduct): void` - сохраняет выбранный товар в соответствующее поле;
- `getProductPreview(): IProduct` - возвращает выбранный товар.

#### Класс UserData
Класс предназначен для хранения и работы с данными покупателя (пользователя).\
Конструктор класса принимает `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `user: IUser` - данные пользователя;
- `events: IEvents` - экземпляр класса EventEmitter для генерации событий при изменении данных.

**Методы класса:**
- `setUserData(user: Partial<IUser>): void` - устанавливает данные пользователя\
(можно частями при оформлении заказа в корзине);
- `getUserData(): IUser` - возвращает полные данные пользователя;
- `checkUserValidation(): boolean` - определяет валидность введенных данных.

#### Класс BasketData
Класс предназначен для хранения и работы с данными корзины покупок.\
Конструктор класса принимает `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `products: IProduct[]` - массив товаров в корзине;
- `events: IEvents` - экземпляр класса EventEmitter для генерации событий при изменении данных.

**Методы класса:**
- `getProductsList(): IProduct[]` - возвращает массив товаров в корзине;
- `getProductsCount(): number` - возвращает число количества товаров в корзине;
- `getProductsPrice(): number` - возвращает итоговую стоимость товаров в корзине;
- `addToBasket(product: IProduct): void` - метод добавления товара в корзину;
- `deleteFromBasket(product: IProduct): void` - метод удаления товара из корзины;
- `clearBasket(): void()` - полностью очищает корзину;
- `isProductInBasket(id: string): boolean` - метод, определяющий, есть ли\
конкретный товар в корзине.

### Слой представления
Классы представления отвечают за отображение внутри переданного в конструктор\
DOM элемента - контейнера. Интерфейсы для таких классов описаны в файле `types/index.ts`.

#### Класс Modal
Класс реализует общий функционал модальных окон веб приложения. Внутреннее содержимое\
модального окна отрисовывается в зависимости от контекста (события) приложения.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `_content: HTMLElement` - разметка, переданная для отрисовки в модальном окне.
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна;
- `events: IEvents` - экземпляр класса EventEmitter;

**Методы класса:**
- `set content(element: HTMLElement)` - сеттер сохраняет разметку в соответсвующее поле класса;
- `open(): void` - открыть модальное окно;
- `close(): void` - закрыть модальное окно;
- `handleEscUp(): void` - закрыть модальное окно по кнопке "Esc".

#### Класс Success
Класс, содержащий разметку для модального окна подтверждения покупки.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `totalPriceElement: HTMLElement` - сумма покупки;
- `successCloseButton: HTMLButtonElement` - кнопка закрытия, после удачной покупки.

**Методы класса:**
- `set totalPrice(value: number)` - сеттер, устанавливающий сумму покупку.

#### Класс Basket
Класс, содержащий разметку для модального окна корзины товаров.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `basketListElement: HTMLElement` - список товаров в корзине;
- `orderButton: HTMLButtonElement` - кнопка для оформления заказа;
- `totalPriceElement: HTMLElement` - общая сумма заказа.

**Методы класса:**
- `set basketList(item: HTMLElement)` - сеттер сохраняет список товаров в соответсвующее поле;
- `set totalPrice(value: number)` - сеттер устанавливает общую сумму заказа;
- `set valid(value: boolean)` - сеттер, устанавливающий валидность корзины (для кнопки оформления).

#### Класс Form
Родительский класс для всех форм веб приложения. Содержит в себе общий функционал\,
который будут наследовать дочерние классы представления форм. Так же отрисовывается\
внутри общего модального окна.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `submitButton: HTMLButtonElement` - кнопка сабмита (отправки) формы;
- `errorsElement: HTMLElement` - элемент, показывающий ошибки при валидации формы.

**Методы класса:**
- `set valid(value: boolean)` - сеттер, устанавливающий валидность формы;
- `set errors(value: string)` - сеттер, устанавливающий ошибки для формы.

#### Класс FormOrder
Дочерний класс `Form`, содержащий разметку для модального окна оформления заказа с адресом\
и способом оплаты.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `cashButton: HTMLButtonElement` - кнопка переключения на оплату при получении;
- `onlineButton: HTMLButtonElement` - кнопка переключения на оплату онлайн.

**Методы класса:**
- `set cash(value: boolean)` - сеттер, устанавливающий оплату при получении;
- `set online(value: boolean)` - сеттер, устанавливающий оплату онлайн;
- `set address(value: string)` - сеттер, устанавливающий адрес доставки. 

#### Класс FormContacts
Дочерний класс `Form`, содержащий разметку для модального окна оформления заказа с электронной\
почтой и номером телефона.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**Методы класса:**
- `set email(value: string)` - сеттер, устанавливающий электронную почту;
- `set phone(value: string)` - сеттер, устанавливающий номер телефона.

#### Класс ProductItem
Общий класс для карточки товара веб приложения. Содержит в себе повторяющиеся свойства\
и методы, которые наследуются дочерними классами.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `titleElement: HTMLElement` - название товара;
- `priceElement: HTMLElement` - цена товара.

**Методы класса:**
- `set title(value: string)` - сеттер, устанавливающий название товара;
- `set price(value: number | null)` - сеттер, устанавливающий цену товара.

#### Класс GalleryItem
Дочерний класс `ProductItem`, содержит в себе разметку отображения карточки товара\
в общем списке на главной странице веб приложения.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `previewButton: HTMLButtonElement` - кнопка открытия модального окна (превью товара);
- `categoryElement: HTMLElement` - категория, к которой принадлежит товар;
- `imageElement: HTMLElement` - картинка товара;
- `categoryClass` - объект с классами категорий товаров.

**Методы класса:**
- `set category(value: string)` - сеттер, устанавливающий категорию товара;
- `set image(value: string)` - сеттер, устанавливающий картинку товара.

#### Класс PreviewItem
Дочерний класс `ProductItem`, содержит в себе разметку (превью товара), которая\
будет отрисована в модальном окне при открытии.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `toBasketButton: HTMLButtonElement` - кнопка добавления в корзину;
- `categoryElement: HTMLElement` - категория товара;
- `descriptionElement: HTMLElement` - полное описание товара;
- `imageElement: HTMLElement` - картинка товара.

**Методы класса:**
- `set category(value: string)` - сеттер, устанавливающий категорию товара;
- `set description(value: string)` - сеттер, устанавливающий описание товара;
- `set image(value: string)` - сеттер, устанавливающий картинку товара.

#### Класс BasketItem
Дочерний класс `ProductItem`, содержит в себе разметку товара в корзине.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `deleteButton: HTMLButtonElement` - кнопка удаления товара из корзины.

#### Класс Header
Класс предназначен для работы с разметкой шапки веб приложения, в частности с\
корзиной товаров на главной странице.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `basketButton: HTMLButtonElement` - кнопка для открытия корзины;
- `basketCounterElement: HTMLElement` - количество товаров в корзине;
- `events: IEvents` - экземпляр класса EventEmitter.

**Методы класса:**
- `set counter(value: number)` - сеттер для обновления счетчика с количеством\
товаров в корзине.

#### Класс Gallery
Класс предназначен для работы с разметкой галереи (списка товаров) на главной\
странице веб приложения.\
Конструктор класса принимает `container` - родительский контейнер, в котором будет\
происходить поиск DOM элементов, `events` - экземпляр класса EventEmitter для генерации событий.

**В полях класса хранятся следующие данные:**
- `catalogElement: HTMLElement` - каталог для размещения списка товаров.

**Методы класса:**
- `set catalog(items: HTMLElement[])` - сеттер для сохранения списка товаров (карточек).

### Слой коммуникации

#### Класс AppApi
Класс предоставляет методы для работы с сервером веб приложения. В конструкторе\
принимает экземпляр базового класса `Api`.

**В полях класса хранятся следующие данные:**
- `baseApi` - экземпляр базового класса `Api`.

**Методы класса:**
- `getProducts()` - получить с сервера массив товаров;
- `setOrder(data: IOrderData)` - отправить на сервер сформированный заказ.

### Слой взаимодействия (презентер)
Взаимодействие слоев данных и представления происходит при помощи кода, который\
описан в корневом файле `index.ts`, выполняющий роль презентера. Такое взаимодействие\
осуществляется использованием брокера событий, который позволяет генерировать\,
а так же устанавливать на такие события обработчики, запускающие нужный код.\
В файле `index.ts` сначала создаются необходимые экземпляры классов, а затем\
устанавливаются обработчики событий.

**События слоя данных, которые могут генерироваться в веб приложении:**
- `products:saved` - сохранение массива продуктов в слой данных;
- `product:selected` - конкретный продукт сохранен в поле класса данных;
- `user:changed` - данные о покупателе меняются;
- `user:valid` - данные о покупателе валидны;
- `basket:changed` - изменение массива корзины товаров;
- `basket:clear` - корзина очищена;
- `basket:valid` - корзина товаров валидна (для оформления).

**События слоя представления, которые могут генерироваться в веб приложении:**
- `product:open` - открывается модальное окно с превью продукта;
- `product:buy` - нажата кнопка "Купить" в окне превью;
- `product:deleted` - нажата кнопка "Удалить из корзины" в окне превью;
- `basket: open` - открывается модальное окно корзины товаров;
- `basket:order` - нажата кнопка "Оформить" в корзине товаров;
- `form:valid` - форма валидна;
- `formOrder:input` - изменение данных в форме заказа с адресом доставки; 
- `formOrder:submit` - сохранение данных о пользователе в форме с адресом доставки;
- `formContacs:input` - изменение данных в форме с почтой и телефоном;
- `formContacs:submit` - сохранение данных о пользователе в форме с почтой и телефоном.